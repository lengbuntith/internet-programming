<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Display Webcam Stream</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <style>
      #video_display {
        border: 10px #333 solid;
      }
      #container {
        background-color: gray;
        width: 520px;
      }
    </style>
  </head>

  <body>
    <video autoplay="true" id="videoElement" style="display: none"></video>

    <center>
      <canvas width="500" height="375" id="video_display"></canvas><br />
      <div id="container">
        <span>ðŸ™‰ PLease show your beautiful face please ðŸ™‰ </span><br />
        <button id="start" class="btn btn-primary">Start</button>
        <button id="stop" class="btn btn-danger" style="display: none">
          Stop
        </button>
      </div>
    </center>

    <script>
      const start = document.getElementById("start");
      const stop = document.getElementById("stop");
      const canvas = document.getElementById("video_display");
      var video = document.querySelector("#videoElement");
      let enableVideo;

      start.addEventListener("click", function (event) {
        console.log("Start");
        start.style.display = "none";
        stop.style.display = "inline-block";
        drawing();
      });

      stop.addEventListener("click", function (event) {
        console.log("Stop");
        start.style.display = "inline-block";
        stop.style.display = "none";
        video.srcObject = null;
        enableVideo.stop();
        const ctx = canvas.getContext("2d");
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, 500, 375);
      });

      function drawing() {
        navigator.mediaDevices
          .getUserMedia({
            audio: false,
            video: true,
          })
          .then(function (stream) {
            video.srcObject = stream;
            enableVideo = stream.getVideoTracks()[0];
            setTimeout(loop, 1000 / 30);
          })
          .catch(function (error) {
            console.log(error);
          });
      }

      function loop() {
        if (video.srcObject) {
          canvas
            .getContext("2d")
            .drawImage(video, 0, 0, canvas.width, canvas.height);
          setTimeout(loop, 1000 / 30);
          console.log(video.srcObject);
        }
      }
    </script>
  </body>
</html>
